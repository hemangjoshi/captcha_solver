var background=function(){"use strict";const O=globalThis.browser?.runtime?.id==null?globalThis.chrome:globalThis.browser;function f(s){return s==null||typeof s=="function"?{main:s}:s}const o=typeof chrome<"u"?chrome:O,I=f(()=>{function s(){o.contextMenus.removeAll(()=>{[{title:"Pick the OCR Type",id:"ocrid",contexts:["page"]},{title:"Pick the OCR image element",id:"ocrPicker",contexts:["page"]},{title:"Pick the input element",id:"inputPicker",contexts:["page"]},{title:"Probot",parentId:"ocrid",id:"probot",contexts:["page"]},{title:"Amazon",parentId:"ocrid",id:"amazon",contexts:["page"]}].forEach(e=>{o.contextMenus.create(e,()=>{o.runtime.lastError&&console.error("Context menu creation error:",o.runtime.lastError)})})})}o.contextMenus.onClicked.addListener((t,e)=>{if(!e?.id)return;const c={menuItemId:t.menuItemId,...t.menuItemId==="ocrPicker"&&{picker:"ocrPicker"},...t.menuItemId==="inputPicker"&&{picker:"inputPicker"}};o.tabs.sendMessage(e.id,c,n=>{o.runtime.lastError&&console.error("Message sending error:",o.runtime.lastError)})}),o.runtime.onMessage.addListener((t,e,c)=>{if(t.type==="networkRequest")return d(t.payload).then(n=>c({success:!0,data:n})).catch(n=>c({success:!1,error:n.message})),!0;t.type==="feedback"&&fetch("https://feedback.captchasonic.com/extFeedback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.payload)}).then(n=>n.json()).then(n=>{}).catch(n=>{}),t.action&&new Set(["popularCaptcha_refresh_iframes","ReCaptcha_refresh_iframes","ERROR_BAD_PARAMETERS","ERROR_TOO_BIG_CAPTCHA_FILESIZE","ERROR_ZERO_CAPTCHA_FILESIZE","ERROR_CAPTCHA_UNSOLVABLE","ERROR_BAD_IMGINSTRUCTIONS","ERROR_BAD_DUPLICATES","ERROR_NO_SUCH_METHOD","ERROR_KEY_DOES_NOT_EXIST","ERROR_ZERO_BALANCE","ERROR_DAILY_LIMIT_EXCEEDED","ERROR_QUOTA_LIMIT_EXCEEDED","ERROR_MINUTE_LIMIT_EXCEEDED"]).has(t.action)&&A(t.action)});async function d({url:t,method:e,headers:c,body:n}){const r=await fetch(t,{method:e||"GET",headers:c||{},body:e!=="GET"?n:void 0});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return r.headers.get("content-type")?.includes("application/json")?await r.json():await r.text()}function A(t){o.tabs.query({active:!0,currentWindow:!0},e=>{e[0]?.id&&o.tabs.sendMessage(e[0].id,{action:t},c=>{o.runtime.lastError&&console.error("Active tab message error:",o.runtime.lastError)})})}async function g(){try{const t=await fetch(o.runtime.getURL("config/defaultConfig.json"));return t.ok?await t.json():null}catch(t){return console.error("Error loading default config:",t),null}}o.runtime.onInstalled.addListener(async t=>{s();const e=await g();if(console.log(t.reason,"reason"),t.reason==="install"&&(e&&await o.storage.local.set({settings:e}),o.tabs.create({url:"/guide.html"})),t.reason==="update"){let E=function(i,T){return i=i.filter(u=>T.includes(u)),T.forEach(u=>{i.includes(u)||i.push(u)}),i};const n=(await o.storage.sync.get("settings")||{}).settings||{};let r={...e};r.APIKEY=e.APIKEY||n.APIKEY||"",r.ACTIVE=n.ACTIVE??e.ACTIVE,r.THEME=n.THEME||e.THEME,r.BLACKLISTENABLED=n.BLACKLISTENABLED??e.BLACKLISTENABLED,r.AUTOOPENENABLED=n.AUTOOPENENABLED??e.AUTOOPENENABLED,r.LOGENABLED=n.LOGENABLED??e.LOGENABLED,r.Local_lang=n.Local_lang||e.Local_lang,r.NOTIFICATION=n.NOTIFICATION??e.NOTIFICATION,r.CAPTCHAS=E(n.CAPTCHAS||[],e.CAPTCHAS),r.TITLES=E(n.TITLES||[],e.TITLES),r.OPTIONS={...n.OPTIONS};for(const i of Object.keys(e.OPTIONS))r.OPTIONS[i]?r.OPTIONS[i]={...e.OPTIONS[i],...n.OPTIONS[i]}:r.OPTIONS[i]=e.OPTIONS[i];await o.storage.local.set({settings:r}),console.log("Extension updated - settings merged successfully")}}),o.runtime.onStartup.addListener(()=>{console.log("Extension initialized")})});function R(){}function a(s,...d){}const p={debug:(...s)=>a(console.debug,...s),log:(...s)=>a(console.log,...s),warn:(...s)=>a(console.warn,...s),error:(...s)=>a(console.error,...s)};let l;try{l=I.main(),l instanceof Promise&&console.warn("The background's main() function return a promise, but it must be synchronous")}catch(s){throw p.error("The background crashed on startup!"),s}return l}();
background;
